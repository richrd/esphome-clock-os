globals:
  # Snake speed (1-20)
  - id: clockos_global_game_snake_speed
    type: int
    initial_value: '7'

  # Walls enabled
  - id: clockos_global_game_snake_walls
    type: bool
    initial_value: 'true'

switch:
  - platform: template
    name: "Snake walls"
    id: switch_game_snake_walls
    restore_mode: RESTORE_DEFAULT_ON
    lambda: |-
      return id(clockos_global_game_snake_walls);
    turn_on_action:
      - lambda: 'id(clockos_global_game_snake_walls) = true;'
    turn_off_action:
      - lambda: 'id(clockos_global_game_snake_walls) = false;'

display:
  - id: !extend clockos_display
    pages:
      - id: clockos_page_game_snake
        lambda: !include "snake.cpp"

graphical_display_menu:
  id: clockos_menu_main
  items:
    - id: !extend clockos_menu_submenu_games
      items:
        - type: menu
          text: ' Snake ⏵ '
          items:
            - type: back
              text: ' ⏴ Back '
            - type: command
              text: ' Play '
              on_value:
                then:
                    - display_menu.hide: clockos_menu_main
                    # Reset knob direction when resuming so menu usage doesn't interfere with game
                    - lambda: 'id(clockos_global_knob_direction) = 0;'
                    - display.page.show: clockos_page_game_snake
            - type: number
              text: ' Speed '
              number: clockos_number_game_snake_speed
            - type: command
              text: !lambda |-
                return std::string(" Walls [") + (id(clockos_global_game_snake_walls) ? "ON" : "OFF") + "]";
              on_value:
                then:
                  - if:
                      condition:
                        lambda: 'return id(clockos_global_game_snake_walls);'
                      then:
                        - switch.turn_off: switch_game_snake_walls
                      else:
                        - switch.turn_on: switch_game_snake_walls

number:
  - platform: template
    id: clockos_number_game_snake_speed
    name: "Speed"
    step: 1
    min_value: 1
    max_value: 20
    optimistic: true
    initial_value: 7
    set_action:
    - lambda: |-
        id(clockos_global_game_snake_speed) = (int)x;
