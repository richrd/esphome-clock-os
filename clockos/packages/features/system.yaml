
display:
  - id: !extend clockos_display
    pages:
      - id: page_feature_system
        lambda: !include "system.cpp"


# Factory reset switch
switch:
  - platform: factory_reset
    name: "Factory Reset"
    id: clockos_switch_factory_reset


# Example configuration entry
button:
  - platform: factory_reset
    name: Restart with Factory Default Settings
    id: clockos_feature_system_button_factory_reset

script:
  - id: script_feature_system_start_wifi_setup
    then:
      - logger.log: "Starting Wi-Fi setup mode..."
      - wifi.disable
      - button.press: clockos_feature_system_button_factory_reset
      - button.press: clockos_button_restart


graphical_display_menu:
  id: main_menu
  items:
    - id: !extend menu_submenu_settings
      items:
        - type: menu
          text: ' System ⏵ '
          items:
            - type: back
              text: ' ⏴ Back '
            - type: command
              text: ' Status '
              on_value:
                then:
                    - display_menu.hide: main_menu
                    - display.page.show: page_feature_system
            - type: command
              text: !lambda |-
                return std::string(" Wifi [") + (!id(wifi0).is_disabled() ? "ON" : "OFF") + "]";
              on_value:
                then:
                  - if:
                      condition:
                        lambda: 'return !id(wifi0).is_disabled();'
                      then:
                        - wifi.disable
                      else:
                        - wifi.enable
            - type: command
              text: " Restart "
              on_value:
                then:
                  - logger.log: "Restarting ESP32..."
                  - delay: 100ms
                  - button.press: clockos_button_restart
            - type: menu
              text: " Factory Reset "
              items:
                - type: back
                  text: ' ⏴ Back '
                - type: command
                  text: " Confirm Reset? "
                  on_value:
                    then:
                      - script.execute: script_feature_system_start_wifi_setup
